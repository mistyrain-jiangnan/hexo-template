---
title: 使用类型断言达到预期
urlname: xgatwt
date: '2021-12-10 13:50:00 +0800'
categories:
  - Ts
tags:
  - Ts
---

## tags: [vue 修饰符]

categories: [vue 修饰符]

## 类型断言

在学习 TyScript 的时候，虽然 TypeScript 很强大，但有时它还是不如我们了解一个值的类型，这时候我们更希望 TypeScript 不要帮我们进行类型检查，而是交给我们自己来，所以就用到了类型断言。类型断言有点像是一种类型转换，它把某个值强行指定为特定类型 ：

```javascript
const getLength = (target) => {
  if (target.length) {
    return target.length;
  } else {
    return target.toString().length;
  }
};
```

这个函数能够接收一个参数，并返回它的长度，我们可以传入字符串、数组或数值等类型的值。如果有 length 属性，说明参数是数组或字符串类型，如果是数值类型是没有 length 属性的，所以需要把数值类型转为字符串然后再获取 length 值。现在我们限定传入的值只能是字符串或数值类型的值：

```typescript
const getLength = (target: string | number): number => {
  if (target.length) {
    //  类型"string | number"上不存在属性"length"
    return target.length; // 类型"number"上不存在属性"length"
  } else {
    return target.toString().length;
  }
};
```

当 TypeScript 不确定一个联合类型的变量到底是哪个类型的时候，我们只能访问此联合类型的所有类型里共有的属性或方法，所以现在加了对参数 target 和返回值的类型定义之后就会报错。
![image.png](https://cdn.nlark.com/yuque/0/2021/png/12838787/1639116215975-d4a94ec0-0d5d-4c6e-9430-777bcd283f2a.png#clientId=u71ea46b0-f53e-4&from=paste&id=u58fe898e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=310&originWidth=667&originalType=binary∶=1&size=24199&status=done&style=none&taskId=uca4e8114-2b20-44b6-ac65-45cfd789757)
很显然，我们是要做判断的，我们判断如果 target.length 不为 undefined， 说明它是有 length 属性的，但我们的参数是 string | number 联合类型，所以在我们开始做判断的时候就会报错。这个时候就要用类型断言，将 tagrget 的类型断言成 string 类型。它有两种写法，一种是<type>value，一种是 value as type , 例子:

```typescript
const getStrLength = (target: string | number): number => {
  if ((<string>target).length) {
    // 这种形式在JSX代码中不可以使用，而且也是TSLint不建议的写法

    return (target as string).length; // 这种形式是没有任何问题的写法，所以建议大家始终使用这种形式
  } else {
    return target.toString().length;
  }
};
```

​

例子的函数体用到了三次 target，前两次都是访问了 target.length 属性，所以都要用类型断言来表明这个地方是 string 类型；而最后的 target 调用了 toString 方法，因为 number 和 string 类型的值都有 toString 方法，所以没有报错。
这样虽然没问题了，但是每一处不同值会有不同情况的地方都需要用类型断言，后面会使用**自定义类型保护**来简化这里。
注意了，这两种写法都可以，但是 tslint 推荐使用 as 关键字，而且在 JSX 中只能使用 as 这种写法。
​

​

![5cf4bfc100015d6b16000232.jpg](https://cdn.nlark.com/yuque/0/2021/jpeg/12838787/1639116337330-534acb54-7a63-427d-9d74-8d7c9ce28dc3.jpeg#clientId=u71ea46b0-f53e-4&from=ui&id=u7de5a917&margin=%5Bobject%20Object%5D&name=5cf4bfc100015d6b16000232.jpg&originHeight=232&originWidth=1600&originalType=binary∶=1&size=51607&status=done&style=none&taskId=u77d837b2-ece7-46af-a349-de5a00db9d2)
​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​
